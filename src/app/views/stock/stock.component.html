<!-- Top Navigation -->
<app-nav-bar></app-nav-bar>

<!-- Main Content -->
<div class="main-content">
  <!-- Search and Filter Bar -->
  <div class="d-flex gap-1 my-2 w-100">
    <div class="search-box">
      <i class="bi bi-search"></i>
      <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="filterItems()" placeholder="Search items..."
        class="search-input">
    </div>
    <div class="category-filter">
      <select [(ngModel)]="selectedCategory" (ngModelChange)="filterItems()" class="category-select">
        <option value="">All Categories</option>
        <option *ngFor="let category of categories" [value]="category">
          {{category}}
        </option>
      </select>
    </div>
  </div>

  <!-- Metrics Cards -->
  <div class="metrics-grid">
    <div class="metric-card shadow" *ngFor="let metric of metrics; trackBy: trackByMetricTitle">
      <div class="metric-icon">
        <i [class]="metric.icon"></i>
      </div>
      <div class="metric-content">
        <div class="metric-title">{{metric.title}}</div>
        <div class="metric-value">{{metric.value}}</div>
        <div *ngIf="metric.trend" class="metric-trend" [class.trend-up]="metric.trend === 'up'"
          [class.trend-down]="metric.trend === 'down'">
          <i [class]="'bi bi-arrow-' + metric.trend"></i>
          <span>{{metric.trendValue}}%</span>
          <span class="trend-label">vs last month</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Stock Table Section -->
  <div class="table-section shadow">
    <div class="table-header">
      <h4>Inventory Items</h4>
      <button class="btn btn-primary btn-sm p-2" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
        <i class="bi bi-plus-circle"></i>
        Add New Item
      </button>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Item Name</th>
            <th>Type</th>
            <th>Quantity</th>
            <th>Unit Price</th>
            <th>Total Value</th>
            <th>Last Updated</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of filteredItems; trackBy: trackByItemId">
            <td>{{item.stock_name}}</td>
            <td>{{item.stock_type}}</td>
            <td>
              <input type="number" class="quantity-input" [(ngModel)]="item.stock_quantity"
                (ngModelChange)="updateItem(item)">
            </td>
            <td>{{item.stock_price | currency}}</td>
            <td>{{item.stock_price * item.stock_quantity | currency}}</td>
            <td>{{item.updated_at | date:'short'}}</td>
            <td class="actions-cell">
              <button class="action-btn edit-btn" data-bs-toggle="modal" data-bs-target="#staticBackdrop" (click)="editItem(item)">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="action-btn delete-btn" (click)="deleteItem(item.stock_uuid)">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>


<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4>{{editMode ? 'Edit Item' : 'Add New Item'}}</h4>
        <button class="close-btn" (click)="closeModal()" data-bs-dismiss="modal" aria-label="Close">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      <div class="modal-body">
        <form [formGroup]="itemForm" (ngSubmit)="saveItem()">
          <div class="form-group">
            <label for="name">Item Name</label>
            <input type="text" id="name" formControlName="name">
            <div class="error-message" *ngIf="itemForm.controls.name.invalid && itemForm.controls.name.touched">
              Item Name is required
            </div>
          </div>
    
          <div class="form-group">
            <label for="category">Category</label>
            <select id="category" formControlName="category">
              <option value="" disabled>Select Category</option>
              <option *ngFor="let category of categories" [value]="category">
                {{category}}
              </option>
            </select>
            <div class="error-message" *ngIf="itemForm.controls.category.invalid && itemForm.controls.category.touched">
              Category is required
            </div>
          </div>
    
          <div class="form-group">
            <label for="quantity">Quantity</label>
            <input type="number" id="quantity" formControlName="quantity">
            <div class="error-message" *ngIf="itemForm.controls.quantity.invalid && itemForm.controls.quantity.touched">
              Quantity must be at least 1
            </div>
          </div>
    
          <div class="form-group">
            <label for="unitPrice">Unit Price</label>
            <input type="number" id="unitPrice" formControlName="unitPrice">
            <div class="error-message" *ngIf="itemForm.controls.unitPrice.invalid && itemForm.controls.unitPrice.touched">
              Unit Price is required and must be positive
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="cancel-btn" (click)="closeModal()" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="save-btn" [disabled]="itemForm.invalid">
              {{editMode ? 'Update' : 'Add'}} Item
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>